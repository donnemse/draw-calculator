<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>해적이야기 캘린더 / Bounty Pirates Calendar</title>
    <meta property="og:type" content="website">
    <meta property="og:title" content="해적이야기 캘린더 / Bounty Pirates Calendar">
    <meta property="og:description" content="해적이야기 캘린더에서 이벤트 일정을 확인하세요.">
    <meta property="og:image" content="https://donnemse.github.io/draw-calculator/calender_image.png">
    <meta property="og:url" content="https://donnemse.github.io/draw-calculator/calender.html">

    <link rel="icon" href="https://donnemse.github.io/draw-calculator/favicon.ico" type="image/x-icon">
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }

        #header {
            text-align: center;
            padding: 20px 0;
            background-color: #2c3e50;
            color: #fff;
            font-size: 1.2em;
            font-weight: bold;
        }

        #calendar {
            margin: 5px auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            background-color: #fff;
            padding: 5px;
        }

        .fc-direction-ltr .fc-daygrid-event.fc-event-start, .fc-direction-rtl .fc-daygrid-event.fc-event-end {
            margin-left: 1px;
            margin-right: 1px;
        }


        .fc-event-time {
            display: none;
        }

        .fc-daygrid-event .fc-event-title {
            white-space: normal !important;
            word-break: break-word;
            overflow-wrap: break-word;
            padding: 0px;
        }

        .fc-day-sat {
          background: #007eff21 !important;
          color: #7174f3
        }
        
        .fc-day-sun {
          background: #ff000017 !important;
          color: #ff000082;
        }

        .fc-day-today {
          background: #ffb10066 !important;
          color: #ff000082;
          font-weight: bold;
        }

        .fc-header-toolbar {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background-color: #2c3e50;
            color: #fff;
            border-radius: 10px 10px 0 0;
        }

        .fc-toolbar-title {
            font-size: 1.2em !important;
            font-weight: bold;
        }

        .fc-button {
            background-color: #3498db;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            font-size: 0.9em;
            transition: background-color 0.3s;
        }

        .fc-button:hover {
            background-color: #2980b9;
        }

        .fc-button:focus {
            outline: none;
        }

        .fc-daygrid-event {
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 0.8em;
            text-align: center;
            padding: 3px;
            transition: transform 0.2s, background-color 0.3s;
        }

        .fc-daygrid-event:hover {
            transform: scale(1.05);
        }

        .fc-day-today {
            background-color: #f1c40f !important;
            color: #000;
        }

        .fc-day-past {
            background-color: #ecf0f1;
        }

        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.75em;
            display: none;
            pointer-events: none;
            z-index: 1000;
        }

        .language-switch {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .language-switch button {
            margin-left: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #3498db;
            color: #fff;
            font-size: 0.8em;
        }

        .language-switch button:hover {
            background-color: #2980b9;
        }

         /* Footer Style */
        footer {
            background-color: #2c3e50;
            color: #fff;
            text-align: center;
            padding: 15px 0;
            bottom: 0;
            width: 100%;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .footer-links button {
            padding: 8px 15px;
            background-color: #3498db;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .footer-links button:hover {
            background-color: #2980b9;
        }

        .past-event {
          opacity: 0.5; /* 투명도를 조절하여 흐리게 표시 */
          filter: grayscale(70%); /* 흑백 효과 추가 (선택 사항) */
        }
    </style>
</head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-41FZMXQX72"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-41FZMXQX72');
</script>

<body>
    <div id="header">해적이야기 캘린더</div>
    <div class="language-switch">
        <button id="ko-btn">ko</button>
        <button id="en-btn">en</button>
    </div>
    <div id="calendar"></div>
    <div class="tooltip" id="tooltip"></div>

    <p style="margin: 5px 10px; font-weight: bold">패치노트</p>
    <p style="margin: 5px 20px;"> * 2024-10-25 가챠 변칙</p>
    <footer>
        <p style="margin-top: 10px;">Develop by null (H68)</p>
        <div class="footer-links">
            <button id="link1-btn">Draw Calcurator</button>
            <button id="link2-btn">Optimal Draw</button>
        </div>
        <p id="errorMsg"></p>
    </footer>

    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var tooltip = document.getElementById('tooltip');
        var headerEl = document.getElementById('header');
        var currentLanguage = 'ko'; // Default language

        const eventsConfig = {
            ko: [
                '사보', '쌍용', '새턴', '카타', '나스', '밴벡', '쿠마', '에마', '??', '??', '??', '??', '??'
            ],
            en: [
                'Sabo', 'Twin.Drg', 'Saturn', 'Kata', 'Nas', 'Beckman', 'Kuma', 'Ace/YMT', '??', '??', '??', '??', '??'
            ]
        };

        document.getElementById('link1-btn').addEventListener('click', function() {
            window.location.href = 'https://donnemse.github.io/draw-calculator'; // 페이지 1 링크
        });

        document.getElementById('link2-btn').addEventListener('click', function() {
            window.location.href = 'https://donnemse.github.io/draw-calculator/optimal_draw_calculator.html'; // 페이지 2 링크
        });


        function renderCalendar(locale) {
            if (window.calendar) {
                // window.calendar.destroy(); // Properly remove any previous instance
            }

            window.calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: locale,
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: ''
                },
                eventOrder: "start",
                defaultAllDay: true,
                height: 'auto',
                editable: true,
                droppable: true,
                eventMouseEnter: function(info) {
                    tooltip.style.display = 'block';
                    tooltip.style.left = info.jsEvent.pageX + 10 + 'px';
                    tooltip.style.top = info.jsEvent.pageY + 10 + 'px';
                    tooltip.textContent = info.event.title;
                },
                eventMouseLeave: function() {
                    tooltip.style.display = 'none';
                },
                datesSet: function(info) {
                    window.calendar.removeAllEvents();
                    window.calendar.addEventSource(getEventWeek(info.start, info.end));
                    window.calendar.addEventSource(getDrawWeek());
                },
                eventDidMount: function(info) {
                  const today = new Date();
                  const eventDate = info.event.end == null? new Date(info.event.start): new Date(info.event.end -1);
                  if (eventDate < today && !info.isToday) {
                    info.el.classList.add('past-event');
                  }
                }
            });

            window.calendar.render();
        }

        document.getElementById('ko-btn').addEventListener('click', function() {
            currentLanguage = 'ko';
            headerEl.textContent = '해적이야기 캘린더';
            renderCalendar('ko');
        });

        document.getElementById('en-btn').addEventListener('click', function() {
            currentLanguage = 'en';
            headerEl.textContent = 'Bounty Pirates Calendar';
            renderCalendar('en');
        });

        renderCalendar('ko'); // Default to Korean

        function getDrawWeek() {
            const events = [];
            const repeatWeeks = [1, 2, 3, 6, 8, 9, 14];
            const startDate = new Date("2024-05-31");

            eventsConfig[currentLanguage].forEach((event, index) => {
                const baseDate = new Date(startDate);
                baseDate.setDate(baseDate.getDate() + ((index * 3) * 7));
                
                repeatWeeks.forEach((week, idx) => {
                    let eventDate = new Date(baseDate);
                    eventDate.setDate(baseDate.getDate() + ((week - 1) * 7));
                    events.push({
                        title: `${event}#${idx + 1}`,
                        start: eventDate,
                        backgroundColor: '#E8C97A', borderColor: '#D4B563'
                    });
                });
            });

            return events;
        }

        function addDays(date, days) {
            return new Date(date).setDate(new Date(date).getDate() + days)
        }

        function getEventWeek(startDate, endDate) {
            const events = [];
            const titles = {
                ko: {
                    luckyEvent: '보갑',
                    wishSabo: '염원 - 사보 조',
                    wishUta: '염원 - 우타 조',
                    adv: '항로',
                    advX: '항로X',
                    adv120: '항로120',
                    dispatchX: '출정X',
                    sanctuary: '비경',
                    sanctuary99: '비경99',
                    voyages: '원양',
                    gacha: '가챠(불규칙)',
                    end65: '65끝',
                    trainingPath: '수행의길'
                },
                en: {
                    luckyEvent: 'Chest',
                    wishSabo: 'Wish - Sabo',
                    wishUta: 'Wish - Uta',
                    adv: 'Advanture',
                    advX: 'AdvX',
                    adv120: 'adv120',
                    dispatchX: 'DispatchX',
                    sanctuary: 'Sanctuary',
                    sanctuary99: '99Sanctuary',
                    voyages: 'Voyages',
                    gacha: 'Gacha(irregularity)',
                    end65: 'End65',
                    trainingPath: 'Training Path'
                }
            };

            const monday = 1;
            const tuesday = 2;
            const thursday = 4;
            const friday = 5;

            const colorEventWeek = {backgroundColor: '#88C7E3', borderColor: '#70B0CF'};
            const colorLuckyEvent = {backgroundColor: '#F8B4B8', borderColor: '#E39EA1'};
            const colorWishEvent = {backgroundColor: '#E5A27A', borderColor: '#CC8462'};
            const colorPrepareEvent = {backgroundColor: '#81C98A', borderColor: '#6FA677'};
            const colorGachaEvent = {backgroundColor: '#B48EBB', borderColor: '#9C77A5'};
            const colorEnd65 = {backgroundColor: '#f87067', borderColor: '#e61809'};
            const colorTrainingPath = {backgroundColor: '#f8c471', borderColor: '#f39c12'};
            
            
            for (let date = new Date(startDate); date <= endDate; date.setDate(date.getDate() + 1)) {
                const start = new Date(date);
                const end = new Date(date);
                const week = Math.ceil(start.getTime() / (86400000 * 7));
                const days = Math.ceil(start.getTime() / (86400000));

                // 행운 보갑(월) 2주에 한번
                if (date.getDay() === monday && days % 2 == 0){
                    events.push({
                        title: titles[currentLanguage].luckyEvent,
                        start: start,
                        ...colorLuckyEvent
                    });
                // 염원 모집(화) 사보조/우타조
                } else if (date.getDay() === tuesday && week % 2 == 0){
                    let eventTitle = titles[currentLanguage].wishSabo;
                    if (week % 4 == 0) {
                        eventTitle = titles[currentLanguage].wishUta;
                    }
                    events.push({
                        title: eventTitle,
                        start: start,
                        end: addDays(start, 3),
                        ...colorWishEvent
                    });
                }
                /*
                 이벤트 준비
                    * 다음날 비경주이면 99층까지만
                    * 다음날 항로면 진행X
                        항로진행 X의 경우
                        - 6일후 항로120맞춤
                        항로진행 무방일경우
                        - 7일후 항로120맞춤
                */
                else if (date.getDay() === thursday){
                    let eventTitle = null;
                    if (week % 3 == 1) {
                        let afterDays = 7;
                        if (days % 2 == 0) {
                            eventTitle = titles[currentLanguage].advX;
                            afterDays = 6;
                        }
                        events.push({
                            title: titles[currentLanguage].adv120,
                            start: addDays(start, afterDays),
                            ...colorPrepareEvent
                        });
                    } else if (week % 3 == 2 && days % 2 == 1) {
                        eventTitle = titles[currentLanguage].sanctuary99;
                    } else if (week % 3 == 0) {
                        eventTitle = titles[currentLanguage].dispatchX;
                    }

                    if (eventTitle != null) {
                        events.push({
                            title: eventTitle,
                            start: start,
                            ...colorPrepareEvent
                        });
                    }

                    if (week % 3 == 0) {
                        events.push({
                            title: titles[currentLanguage].end65,
                            start: start,
                            ...colorEnd65
                        });
                    }
                /*
                    금요일 
                        비경, 원양, 항로 7주일간 로테이션
                        격주로 가챠 진행
                            - 4일과 7일 반복 (추측)
                */
                } else if (date.getDay() === friday) {
                    let eventTitle = (week % 3 === 0) ? titles[currentLanguage].sanctuary : (week % 3 === 1) ? titles[currentLanguage].voyages : titles[currentLanguage].adv;
                    events.push({
                        title: eventTitle,
                        start: start,
                        end: addDays(start, 7),
                        ...colorEventWeek
                    });

                    console.log("************")
                    console.log(start)
                    console.log(new Date(addDays(start, 1)))
                    const isEvenWeek = week % 2 === 0;
                    const isBeforeOrOnTargetDate = start <= new Date("2024-10-25 00:00:00");
                    const isAfterOrOnTargetDate = start >= new Date("2024-10-25 00:00:00");

                    let shouldAddEvent = 
                        (isEvenWeek && isBeforeOrOnTargetDate) || 
                        (!isEvenWeek && isAfterOrOnTargetDate);

                    if (shouldAddEvent) {
                        let duration = (week % 4 === 0) ? 7 : 4;

                        events.push({
                            title: titles[currentLanguage].gacha,
                            start: start,
                            end: addDays(start, duration),
                            ...colorGachaEvent
                        });
                    }

                    if (week % 2 == 1) {
                        events.push({
                            title: titles[currentLanguage].trainingPath,
                            start: start,
                            end: addDays(start, 7),
                            ...colorTrainingPath
                        });
                    }
                }
            }

            return events;
        }
    });
    </script>
</body>
</html>
